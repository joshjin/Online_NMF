%% PCA demo -- digit
clear
fid = fopen( 't10k-images.idx3-ubyte', 'r' );
data = fread( fid, 'uint8' );
fclose(fid);
data = data(17:end);
disp(size(data))
data = reshape( data, 28*28, 10000 )';
short_data = data(28*)

fid = fopen( 't10k-labels.idx1-ubyte', 'r' );
label = fread( fid, 'uint8' );
fclose(fid);
label = label(9:end);
disp(size(label))

show_data = reshape(data,10000,28,28);
disp(size(show_data));
disp('Expanding Images to 3x3 Patch\n');
V = expand3x3(data);
disp(size(V))
[len,~,~] = size(V);
V = reshape(V,len,9);

disp('NNMF Optimizing Step 1')
[W1,H1] = nmf_step_new(V,26,20);
% disp('NNMF Optimizing Step 2')
% [W2,H2] = nmf_step(H1',24,20);
% disp('NNMF Optimizing Step 3')
% [W3,H3] = nmf_step(H2',22,20);
% disp('NNMF Optimizing Step 4')
% [W4,H4] = nmf_step(H3',20,40);
% disp('NNMF Optimizing Step 5')
% [W5,H5] = nmf_step(H4',18,40);
% disp('NNMF Optimizing Step 6')
% [W6,H6] = nmf_step(H5',16,40);
% disp('NNMF Optimizing Step 7')
% [W7,H7] = nmf_step(H6',14,80);
% disp('NNMF Optimizing Step 8')
% [W8,H8] = nmf_step(H7',12,80);
% disp('NNMF Optimizing Step 9')
% [W9,H9] = nmf_step(H8',10,80);
% disp('NNMF Optimizing Step 10')
% [W10,H10] = nmf_step(H9',8,80);
% [len,~,~] = size(V);
% V = reshape(V,len,9);
% disp('NNMF Optimizing\n')
% %%
% [W,H] = nnmf(V(:,:)',9);


